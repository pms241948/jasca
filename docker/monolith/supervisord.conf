[supervisord]
nodaemon=true
logfile=/var/log/supervisord.log
pidfile=/var/run/supervisord.pid

[program:postgresql]
priority=10
command=/usr/lib/postgresql/14/bin/postgres -D /var/lib/postgresql/data
user=postgres
autorestart=true
stdout_logfile=/var/log/postgresql.log
stderr_logfile=/var/log/postgresql.err

[program:redis]
priority=20
command=redis-server /etc/redis/redis.conf
user=redis
autorestart=true
stdout_logfile=/var/log/redis.log
stderr_logfile=/var/log/redis.err

[program:api]
directory=/app
command=node apps/api/dist/main
user=root
autorestart=true
environment=NODE_ENV=production,DATABASE_URL="postgresql://jasca:jasca_secret@127.0.0.1:5432/jasca?sslmode=disable",REDIS_URL="redis://127.0.0.1:6379",JWT_SECRET="jasca_offline_secret"
stdout_logfile=/var/log/api.log
stderr_logfile=/var/log/api.err

[program:web]
directory=/app
command=node apps/web/server.js
user=root
autorestart=true
environment=NODE_ENV=production,PORT=3000,HOSTNAME="0.0.0.0",NEXT_PUBLIC_API_URL="http://localhost:3001"
stdout_logfile=/var/log/web.log
stderr_logfile=/var/log/web.err
